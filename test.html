<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test system</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <form id="upload" enctype="multipart/form-data">
        <input type="file" class="form-control"  accept="image/*" name="userImage" value="">
        <input type="submit" value="submit">
    </form>
    <div class="imageContent">
      
    </div>
<script>
document.addEventListener('DOMContentLoaded', function () {

  const testData = [];

    $(document).ready(function(e) {
      $('#upload').on('submit', function(e) {
        e.preventDefault();
        console.log('Click Submit data.');

        $.ajax({
          type: 'POST',
          url: 'php/action.php?action=test',
          data: new FormData(this),
          datatype: 'json',
          contentType: false,
          cache: false,
          processData: false,
          error: function(err) {
            console.log('error: ', err);
          },
          success: function(data) {
            if(data.error){
              console.log(data.error);
            }else{
              console.log(data);
            }
          }
        });
      });
    });

    function updateData(data) {
      
      testData.length = 0; 
    
        data.forEach(test => {
          testData.push({
            id: test.id,
            data: test.imgData,
            type: test.imgType
          });
        });
        updateSource(); 
    }

    function fetchData(){
      fetch('php/test.php')
      .then(response => response.json()) // Assuming the PHP returns JSON data
      .then(data => {
        updateData(data);
      })
      .catch(error => console.error('Error fetching test data:', error));
    }

    function updateSource(){
      const formatData = document.querySelector('.imageContent');
      formatData.innerHTML = '';

      testData.forEach( data => {
        const dataURL = `data:${data.type};base64,${data.data}`;
        const formHTMLData = `
          <img src="${dataURL}" alt="Image">
        `;
        formatData.insertAdjacentHTML('beforeend', formHTMLData);
      });
    }

    fetchData();
});
</script>
</body>
</html>